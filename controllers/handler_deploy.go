package controllers

import (
	"backend/logic"
	"backend/models"
	"encoding/json"
	"fmt"
	"github.com/gin-gonic/gin"
	"go.uber.org/zap"
	"net/http"
	"time"
)

// GetAbiBytecodeHandler 获取合约abi和bytecode
func GetAbiBytecodeHandler(c *gin.Context) {
	//部署前登陆
	abi := "[{\"inputs\":[{\"internalType\":\"string\",\"name\":\"name\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"symbol\",\"type\":\"string\"},{\"internalType\":\"uint8\",\"name\":\"decimal\",\"type\":\"uint8\"},{\"internalType\":\"uint256\",\"name\":\"totalSupply\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"allowance\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"needed\",\"type\":\"uint256\"}],\"name\":\"ERC20InsufficientAllowance\",\"type\":\"error\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"balance\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"needed\",\"type\":\"uint256\"}],\"name\":\"ERC20InsufficientBalance\",\"type\":\"error\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"approver\",\"type\":\"address\"}],\"name\":\"ERC20InvalidApprover\",\"type\":\"error\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"receiver\",\"type\":\"address\"}],\"name\":\"ERC20InvalidReceiver\",\"type\":\"error\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"}],\"name\":\"ERC20InvalidSender\",\"type\":\"error\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"}],\"name\":\"ERC20InvalidSpender\",\"type\":\"error\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"OwnableInvalidOwner\",\"type\":\"error\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"account\",\"type\":\"address\"}],\"name\":\"OwnableUnauthorizedAccount\",\"type\":\"error\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"previousOwner\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"account\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"account\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"burnFrom\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"renounceOwnership\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]\n"
	bytecode := "608060405234801562000010575f80fd5b5060405162001d4038038062001d40833981810160405281019062000036919062000684565b33848481600390816200004a91906200095f565b5080600490816200005c91906200095f565b5050505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603620000d2575f6040517f1e4fbdf7000000000000000000000000000000000000000000000000000000008152600401620000c9919062000a86565b60405180910390fd5b620000e3816200011b60201b60201c565b5081600560146101000a81548160ff021916908360ff160217905550620001113382620001de60201b60201c565b5050505062000b6f565b5f60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508160055f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160362000251575f6040517fec442f0500000000000000000000000000000000000000000000000000000000815260040162000248919062000a86565b60405180910390fd5b620002645f83836200026860201b60201c565b5050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603620002bc578060025f828254620002af919062000ace565b925050819055506200038d565b5f805f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205490508181101562000348578381836040517fe450d38c0000000000000000000000000000000000000000000000000000000081526004016200033f9392919062000b19565b60405180910390fd5b8181035f808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603620003d6578060025f828254039250508190555062000420565b805f808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516200047f919062000b54565b60405180910390a3505050565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b620004ed82620004a5565b810181811067ffffffffffffffff821117156200050f576200050e620004b5565b5b80604052505050565b5f620005236200048c565b9050620005318282620004e2565b919050565b5f67ffffffffffffffff821115620005535762000552620004b5565b5b6200055e82620004a5565b9050602081019050919050565b5f5b838110156200058a5780820151818401526020810190506200056d565b5f8484015250505050565b5f620005ab620005a58462000536565b62000518565b905082815260208101848484011115620005ca57620005c9620004a1565b5b620005d78482856200056b565b509392505050565b5f82601f830112620005f657620005f56200049d565b5b81516200060884826020860162000595565b91505092915050565b5f60ff82169050919050565b620006288162000611565b811462000633575f80fd5b50565b5f8151905062000646816200061d565b92915050565b5f819050919050565b62000660816200064c565b81146200066b575f80fd5b50565b5f815190506200067e8162000655565b92915050565b5f805f80608085870312156200069f576200069e62000495565b5b5f85015167ffffffffffffffff811115620006bf57620006be62000499565b5b620006cd87828801620005df565b945050602085015167ffffffffffffffff811115620006f157620006f062000499565b5b620006ff87828801620005df565b9350506040620007128782880162000636565b925050606062000725878288016200066e565b91505092959194509250565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f60028204905060018216806200078057607f821691505b6020821081036200079657620007956200073b565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f60088302620007fa7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82620007bd565b620008068683620007bd565b95508019841693508086168417925050509392505050565b5f819050919050565b5f62000847620008416200083b846200064c565b6200081e565b6200064c565b9050919050565b5f819050919050565b620008628362000827565b6200087a62000871826200084e565b848454620007c9565b825550505050565b5f90565b6200089062000882565b6200089d81848462000857565b505050565b5b81811015620008c457620008b85f8262000886565b600181019050620008a3565b5050565b601f8211156200091357620008dd816200079c565b620008e884620007ae565b81016020851015620008f8578190505b620009106200090785620007ae565b830182620008a2565b50505b505050565b5f82821c905092915050565b5f620009355f198460080262000918565b1980831691505092915050565b5f6200094f838362000924565b9150826002028217905092915050565b6200096a8262000731565b67ffffffffffffffff811115620009865762000985620004b5565b5b62000992825462000768565b6200099f828285620008c8565b5f60209050601f831160018114620009d5575f8415620009c0578287015190505b620009cc858262000942565b86555062000a3b565b601f198416620009e5866200079c565b5f5b8281101562000a0e57848901518255600182019150602085019450602081019050620009e7565b8683101562000a2e578489015162000a2a601f89168262000924565b8355505b6001600288020188555050505b505050505050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f62000a6e8262000a43565b9050919050565b62000a808162000a62565b82525050565b5f60208201905062000a9b5f83018462000a75565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f62000ada826200064c565b915062000ae7836200064c565b925082820190508082111562000b025762000b0162000aa1565b5b92915050565b62000b13816200064c565b82525050565b5f60608201905062000b2e5f83018662000a75565b62000b3d602083018562000b08565b62000b4c604083018462000b08565b949350505050565b5f60208201905062000b695f83018462000b08565b92915050565b6111c38062000b7d5f395ff3fe608060405234801561000f575f80fd5b50600436106100e8575f3560e01c8063715018a61161008a57806395d89b411161006457806395d89b4114610236578063a9059cbb14610254578063dd62ed3e14610284578063f2fde38b146102b4576100e8565b8063715018a6146101f257806379cc6790146101fc5780638da5cb5b14610218576100e8565b806323b872dd116100c657806323b872dd14610158578063313ce5671461018857806342966c68146101a657806370a08231146101c2576100e8565b806306fdde03146100ec578063095ea7b31461010a57806318160ddd1461013a575b5f80fd5b6100f46102d0565b6040516101019190610e11565b60405180910390f35b610124600480360381019061011f9190610ec2565b610360565b6040516101319190610f1a565b60405180910390f35b610142610382565b60405161014f9190610f42565b60405180910390f35b610172600480360381019061016d9190610f5b565b61038b565b60405161017f9190610f1a565b60405180910390f35b6101906103b9565b60405161019d9190610fc6565b60405180910390f35b6101c060048036038101906101bb9190610fdf565b6103cf565b005b6101dc60048036038101906101d7919061100a565b6103e3565b6040516101e99190610f42565b60405180910390f35b6101fa610428565b005b61021660048036038101906102119190610ec2565b61043b565b005b61022061045b565b60405161022d9190611044565b60405180910390f35b61023e610483565b60405161024b9190610e11565b60405180910390f35b61026e60048036038101906102699190610ec2565b610513565b60405161027b9190610f1a565b60405180910390f35b61029e6004803603810190610299919061105d565b610535565b6040516102ab9190610f42565b60405180910390f35b6102ce60048036038101906102c9919061100a565b6105b7565b005b6060600380546102df906110c8565b80601f016020809104026020016040519081016040528092919081815260200182805461030b906110c8565b80156103565780601f1061032d57610100808354040283529160200191610356565b820191905f5260205f20905b81548152906001019060200180831161033957829003601f168201915b5050505050905090565b5f8061036a61063b565b9050610377818585610642565b600191505092915050565b5f600254905090565b5f8061039561063b565b90506103a2858285610654565b6103ad8585856106e6565b60019150509392505050565b5f600560149054906101000a900460ff16905090565b6103e06103da61063b565b826107d6565b50565b5f805f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b610430610855565b6104395f6108dc565b565b61044d8261044761063b565b83610654565b61045782826107d6565b5050565b5f60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b606060048054610492906110c8565b80601f01602080910402602001604051908101604052809291908181526020018280546104be906110c8565b80156105095780601f106104e057610100808354040283529160200191610509565b820191905f5260205f20905b8154815290600101906020018083116104ec57829003601f168201915b5050505050905090565b5f8061051d61063b565b905061052a8185856106e6565b600191505092915050565b5f60015f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905092915050565b6105bf610855565b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160361062f575f6040517f1e4fbdf70000000000000000000000000000000000000000000000000000000081526004016106269190611044565b60405180910390fd5b610638816108dc565b50565b5f33905090565b61064f838383600161099f565b505050565b5f61065f8484610535565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81146106e057818110156106d1578281836040517ffb8f41b20000000000000000000000000000000000000000000000000000000081526004016106c8939291906110f8565b60405180910390fd5b6106df84848484035f61099f565b5b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610756575f6040517f96c6fd1e00000000000000000000000000000000000000000000000000000000815260040161074d9190611044565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036107c6575f6040517fec442f050000000000000000000000000000000000000000000000000000000081526004016107bd9190611044565b60405180910390fd5b6107d1838383610b6e565b505050565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610846575f6040517f96c6fd1e00000000000000000000000000000000000000000000000000000000815260040161083d9190611044565b60405180910390fd5b610851825f83610b6e565b5050565b61085d61063b565b73ffffffffffffffffffffffffffffffffffffffff1661087b61045b565b73ffffffffffffffffffffffffffffffffffffffff16146108da5761089e61063b565b6040517f118cdaa70000000000000000000000000000000000000000000000000000000081526004016108d19190611044565b60405180910390fd5b565b5f60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508160055f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603610a0f575f6040517fe602df05000000000000000000000000000000000000000000000000000000008152600401610a069190611044565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610a7f575f6040517f94280d62000000000000000000000000000000000000000000000000000000008152600401610a769190611044565b60405180910390fd5b8160015f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055508015610b68578273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92584604051610b5f9190610f42565b60405180910390a35b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610bbe578060025f828254610bb2919061115a565b92505081905550610c8c565b5f805f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905081811015610c47578381836040517fe450d38c000000000000000000000000000000000000000000000000000000008152600401610c3e939291906110f8565b60405180910390fd5b8181035f808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610cd3578060025f8282540392505081905550610d1d565b805f808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610d7a9190610f42565b60405180910390a3505050565b5f81519050919050565b5f82825260208201905092915050565b5f5b83811015610dbe578082015181840152602081019050610da3565b5f8484015250505050565b5f601f19601f8301169050919050565b5f610de382610d87565b610ded8185610d91565b9350610dfd818560208601610da1565b610e0681610dc9565b840191505092915050565b5f6020820190508181035f830152610e298184610dd9565b905092915050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610e5e82610e35565b9050919050565b610e6e81610e54565b8114610e78575f80fd5b50565b5f81359050610e8981610e65565b92915050565b5f819050919050565b610ea181610e8f565b8114610eab575f80fd5b50565b5f81359050610ebc81610e98565b92915050565b5f8060408385031215610ed857610ed7610e31565b5b5f610ee585828601610e7b565b9250506020610ef685828601610eae565b9150509250929050565b5f8115159050919050565b610f1481610f00565b82525050565b5f602082019050610f2d5f830184610f0b565b92915050565b610f3c81610e8f565b82525050565b5f602082019050610f555f830184610f33565b92915050565b5f805f60608486031215610f7257610f71610e31565b5b5f610f7f86828701610e7b565b9350506020610f9086828701610e7b565b9250506040610fa186828701610eae565b9150509250925092565b5f60ff82169050919050565b610fc081610fab565b82525050565b5f602082019050610fd95f830184610fb7565b92915050565b5f60208284031215610ff457610ff3610e31565b5b5f61100184828501610eae565b91505092915050565b5f6020828403121561101f5761101e610e31565b5b5f61102c84828501610e7b565b91505092915050565b61103e81610e54565b82525050565b5f6020820190506110575f830184611035565b92915050565b5f806040838503121561107357611072610e31565b5b5f61108085828601610e7b565b925050602061109185828601610e7b565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f60028204905060018216806110df57607f821691505b6020821081036110f2576110f161109b565b5b50919050565b5f60608201905061110b5f830186611035565b6111186020830185610f33565b6111256040830184610f33565b949350505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61116482610e8f565b915061116f83610e8f565b92508282019050808211156111875761118661112d565b5b9291505056fea264697066735822122090b155ffd018f343d4f31b683726f5e3b58429087c1c9419eb3df010dbc5cd1a64736f6c63430008160033"

	c.JSON(http.StatusOK, gin.H{
		"msg": "success",
		"data": gin.H{
			"abi":      json.RawMessage(abi),
			"bytecode": bytecode,
		},
	})
}

func DeployHandler(c *gin.Context) {
	//1.参数校验
	p := new(models.DeployParam)
	if err := c.ShouldBindJSON(p); err != nil {
		zap.L().Error("DeployHandler c.ShouldBindJSON failed", zap.Error(err))
		c.JSON(http.StatusBadRequest, gin.H{
			"msg":  "请求参数错误",
			"data": false,
		})
		return
	}
	address, err := getCurrentUser(c)
	if err != nil {
		zap.L().Error("DeployHandler getCurrentUser failed", zap.Error(err))
		c.JSON(http.StatusInternalServerError, gin.H{
			"msg":  "服务端错误",
			"data": "解析address失败",
		})
		return
	}
	if !TxHashCheck(p.TxHash) {
		zap.L().Error("DeployHandler with invalid param")
		c.JSON(http.StatusBadRequest, gin.H{
			"msg":  "请求参数错误",
			"data": false,
		})
		return
	}
	c.JSON(http.StatusOK, gin.H{
		"msg":  "success",
		"data": true,
	})

	//2.监听消息，如果部署成功，将合约地址和用户信息保存
	for i := 0; i <= 120; i++ {
		receipt, contractAddress, err := logic.CheckDeploySuccess(p.TxHash)
		if err != nil || receipt == "Pending" {
			zap.L().Error("DeployHandler logic.CheckDeploySuccess failed", zap.Error(err))
			<-time.After(time.Second)
			continue
		}
		if receipt == "Success" {
			err = logic.SaveContractInfo(p, address, contractAddress)
			if err != nil {
				fmt.Println(err)
				zap.L().Error("DeployHandler logic.SaveContractInfo failed", zap.Error(err))
			}
			break
		}
		if receipt == "Failed" {
			break
		}
	}
}
